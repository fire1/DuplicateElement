/*
 * Copyright (C) 2015 Angel Zaprianov <me@fire1.eu>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 * Dublicate Fields version: 1.1
 */
!function(e){e.fn.duplicateElement=function(t){function n(e,n,a){i.find("#"+t.tag_id+a).append(n),e.find(t.class_remove).show(),e.find(t.class_remove).last().hide(),e.find(t.class_create).hide(),e.find(t.class_create).last().show()}t=e.extend(e.fn.duplicateElement.defaults,t);var a=this,i=e(a).parent();return this.each(function(i){var s=e(this),l=document.createElement(t.tag_name);l.setAttribute("id",t.tag_id+i),s[0].parentNode.appendChild(l),s.find(t.class_create).unbind(),s.parent().on("click",t.class_create,function(l){var d,c=e(this).parents(".dinamic-field"),r=e(this).parent();return c.length>0?d=c.clone():r.length>0&&(d=e(a[i]).clone().addClass("dinamic-field")),n(s.parent(),d,i),"function"==typeof t.onCreate&&t.onCreate(d,e(this),l),l.preventDefault(),!1}),s.find(t.class_remove).first().hide(),e(s).parent().on("click",t.class_remove,function(n){var a=e(this).parents(".dinamic-field"),i=e(this).parents(s);return a.length>0?a.remove():i.length>0&&(e(s).empty(),e(s).hide()),"function"==typeof t.onRemove&&t.onRemove(e(this)),n.preventDefault(),!1})})},e.fn.duplicateElement.defaults={tag_name:"div",tag_id:"#dinamic-fields",clone_model:"#clone-field-model",class_remove:".remove-this-fields",class_create:".create-new-fields",onCreate:"",onRemove:""}}(jQuery);